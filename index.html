<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Fee Payment</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="bg-white p-6 rounded-lg shadow-xl w-96 text-center">
        <h2 class="text-2xl font-bold text-gray-700 mb-4">Fee Payment Portal</h2>
        <input type="text" id="rollNumber" placeholder="Enter Roll Number"
               class="w-full p-2 border border-gray-300 rounded-md mb-3">
        <button onclick="fetchDues()" class="bg-blue-600 text-white px-4 py-2 rounded-md w-full">
            Get Dues
        </button>

        <div id="duesSection" class="hidden mt-4">
            <p><strong>Name:</strong> <span id="studentName"></span></p>
            <p><strong>College Fees:</strong> ₹<span id="collegeFees"></span></p>
            <p><strong>Transport Fees:</strong> ₹<span id="transportFees"></span></p>
            <p><strong>Pending Fees:</strong> ₹<span id="pendingFees"></span></p>

            <input type="number" id="payAmount" placeholder="Enter amount to pay"
                   class="w-full p-2 border border-gray-300 rounded-md mt-3">
            <button onclick="makePayment()" class="bg-green-600 text-white px-4 py-2 rounded-md w-full mt-3">
                Pay Now
            </button>
        </div>
    </div>

    <script>
        async function fetchDues() {
            const rollNumber = document.getElementById("rollNumber").value;
            if (!rollNumber) {
                alert("Please enter roll number");
                return;
            }

            const response = await fetch(`http://localhost:5000/api/get-dues/${rollNumber}`);
            const data = await response.json();

            if (data.error) {
                alert("Student not found!");
                return;
            }

            document.getElementById("studentName").innerText = data.name;
            document.getElementById("collegeFees").innerText = data.college_fees;
            document.getElementById("transportFees").innerText = data.transport_fees;
            document.getElementById("pendingFees").innerText = data.pending_fees;

            document.getElementById("duesSection").classList.remove("hidden");
        }
      
     
        async function makePayment() {
            const rollNumber = document.getElementById("rollNumber").value;
            const amount = document.getElementById("payAmount").value;
            const response = await fetch("http://localhost:5000/api/pay", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ rollNumber, amount }),
            });
            
            const result = await response.json();

            if (result.error) {
                alert("Payment error: " + result.error);
                return;
            }

            window.location.href = result.paymentLink;
        }
    </script>
</body>
</html>
